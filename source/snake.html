<!DOCTYPE html>
<html lang="ru">

<head>
  <include src="source/templates/head.html"></include>
  <title>Игра - змейка</title>
  <script src="js/main.js"></script>
</head>

<body>

  <div style="display: none;">
    <include src="build/img/sprite.svg"></include>
  </div>

  <include src="source/templates/header.html"></include>

  <main class="page-main">
    <div class="page-title">
      <div class="container">
        <h1 class="page-title__text">Змейка</h1>
        <p class="page-title__subtitle">Расслабся</p>
      </div>
    </div>

    <section class="container">
      <div style="text-align: center;padding-top: 15px;">
        <div id="snake">
          <img src="img/cat-logo.svg" alt="#" id="snake__img">
          <span id="snake__score"></span>
          <button class="snake__button">заново</button>
        </div>
        <div class="snake-driver-wrap">
          <div class="snake-driver">
            <button class="btn snake-driver__button snake-driver__button--up" id="snake-driver__button--up"></button>
            <button class="btn snake-driver__button snake-driver__button--right"></button>
            <button class="btn snake-driver__button snake-driver__button--left"></button>
            <button class="btn snake-driver__button snake-driver__button--down"></button>
          </div>
        </div>
      </div>

      <style>
        .snake-driver-wrap {
          display: block;
          width: 120px;
          height: 120px;
          margin: 50px auto 0;
        }

        .snake-driver {
          transform: rotate(45deg);
          display: flex;
          flex-wrap: wrap;
          width: 100px;
          height: 100px;
        }

        .snake-driver__button {
          width: 50px;
          height: 50px;
          box-sizing: border-box;
          border-radius: 4px;
          background-color: transparent;
          box-shadow: none;
          outline-color: #d29948;
          padding: 0;
          background-image: url("../img/arrow.svg");
          background-size: cover;
          background-repeat: no-repeat;
        }

        .snake-driver__button--right {
          transform: rotate(90deg);
        }

        .snake-driver__button--down {
          transform: rotate(180deg);
        }

        .snake-driver__button--left {
          transform: rotate(-90deg);
        }

        #snake {
          display: inline-block;
          position: relative;
          width: 50vh;
          height: 50vh;
        }

        #snake__score {
          position: absolute;
          top: 0;
          left: 0;
          background-color: transparent;
          padding: 10px;
          color: red;
          display: block;
        }

        #snake__score.snake__game-over {
          top: 50%;
          left: 50%;
          transform: translate(-50%, 70%);
          background-color: #fff;
          font-size: 1.5em;
          font-weight: bold;
        }

        #snake__img {
          position: absolute;
          top: 50%;
          transform: translateY(-50%);
          left: 0;
          display: none;
        }

        .snake__button {
          background-color: transparent;
          border: none;
          box-shadow: none;
          font-size: 12px;
          color: green;
          position: absolute;
          top: 0;
          right: 0;
          padding: 10px;
          display: none;
        }

        .field-snake {
          display: flex;
          flex-wrap: wrap;
          width: 50vh;
          height: 50vh;
          border: 1px solid #580590;
          background-color: rgb(217, 255, 225);
          margin: 0 auto;
        }

        .field-snake__exel {
          width: 5%;
          height: 5%;
          border: 1px solid #eadede38;
          box-sizing: border-box;
        }

        .field-snake__body {
          border: 1px solid #580590;
          border-radius: 35%;
          background-color: #b050f0;
        }

        .field-snake__head {
          background-color: #580590;
          border-radius: 45%;
        }

        .field-snake__mouse {
          border: 1px solid #580590;
          background-color: #1bfd07;
          border-radius: 50%;
        }

      </style>

      <script>
        $(document).ready(function () {
          function my_snke() {
            var field_snake = document.getElementById("snake");

            var field = document.createElement("div");
            field_snake.appendChild(field);
            field.classList.add("field-snake");

            for (var i = 1; i < 401; i++) {
              var exel = document.createElement("div");
              field.appendChild(exel);
              exel.classList.add("field-snake__exel");
            }

            var exel = document.getElementsByClassName("field-snake__exel");

            var x = 1,
              y = 20;

            for (var i = 0; i < exel.length; i++) {
              if (x > 20) {
                x = 1;
                y--;
              }
              exel[i].setAttribute("posX", x);
              exel[i].setAttribute("posY", y);
              x++;

            }

            function generate_Snake() {
              var posX = Math.round(Math.random() * (10 - 3) + 3);
              var posY = Math.round(Math.random() * (10 - 1) + 1);

              return [posX, posY];
            }

            var coordinates = generate_Snake();
            var snake__body = [
              document.querySelector('[posX = "' + coordinates[0] + '"][posY = "' + coordinates[1] + '"]'),
              document.querySelector('[posX = "' + (coordinates[0] - 1) + '"][posY = "' + coordinates[1] + '"]'),
              document.querySelector('[posX = "' + (coordinates[0] - 2) + '"][posY = "' + coordinates[1] + '"]')
            ];

            for (var i = 0; i < snake__body.length; i++) {
              snake__body[i].classList.add("field-snake__body");
            }

            snake__body[0].classList.add("field-snake__head");

            var mouse;

            function create_mouse() {

              function generate_mouse() {
                var posX = Math.round(Math.random() * (20 - 1) + 1);
                var posY = Math.round(Math.random() * (20 - 1) + 1);
                return [posX, posY];
              };

              var mouse_coordinates = generate_mouse();
              mouse = document.querySelector('[posX = "' + mouse_coordinates[0] + '"][posY = "' + mouse_coordinates[
                1] + '"]');

              while (mouse.classList.contains("field-snake__body")) {
                var mouse_coordinates = generate_mouse();
                mouse = document.querySelector('[posX = "' + mouse_coordinates[0] + '"][posY = "' +
                  mouse_coordinates[
                    1] +
                  '"]');
              }

              mouse.classList.add("field-snake__mouse");
            };

            create_mouse();

            var direction = "right",
              steps = false,
              input = document.getElementById("snake__score"),
              score = 0;
            input.innerHTML = "Ваши очки: " + score;

            function move() {
              var snake_coordinates = [snake__body[0].getAttribute("posX"), snake__body[0].getAttribute("posY")];
              snake__body[0].classList.remove("field-snake__head");
              snake__body[snake__body.length - 1].classList.remove("field-snake__body");
              snake__body.pop();

              if (direction == "right") {
                if (snake_coordinates[0] < 20) {
                  snake__body.unshift(document.querySelector('[posX = "' + (+snake_coordinates[0] + 1) +
                    '"][posY = "' +
                    snake_coordinates[1] + '"]'));
                } else {
                  snake__body.unshift(document.querySelector('[posX = "1"][posY = "' + snake_coordinates[1] + '"]'));
                }
              } else if (direction == "left") {
                if (snake_coordinates[0] > 1) {
                  snake__body.unshift(document.querySelector('[posX = "' + (+snake_coordinates[0] - 1) +
                    '"][posY = "' +
                    snake_coordinates[1] + '"]'));
                } else {
                  snake__body.unshift(document.querySelector('[posX = "20"][posY = "' + snake_coordinates[1] + '"]'));
                }
              } else if (direction == "up") {
                if (snake_coordinates[1] < 20) {
                  snake__body.unshift(document.querySelector('[posX = "' + snake_coordinates[0] + '"][posY = "' + (
                    +
                    snake_coordinates[1] + 1) + '"]'));
                } else {
                  snake__body.unshift(document.querySelector('[posX = "' + snake_coordinates[0] + '"][posY = "1"]'));
                }
              } else if (direction == "down") {
                if (snake_coordinates[1] > 1) {
                  snake__body.unshift(document.querySelector('[posX = "' + snake_coordinates[0] + '"][posY = "' + (
                    +
                    snake_coordinates[1] - 1) + '"]'));
                } else {
                  snake__body.unshift(document.querySelector('[posX = "' + snake_coordinates[0] + '"][posY = "20"]'));
                }
              }

              if (snake__body[0].getAttribute("posX") == mouse.getAttribute("posX") && snake__body[0].getAttribute(
                  "posY") ==
                mouse.getAttribute("posY")) {
                mouse.classList.remove("field-snake__mouse");
                var a = snake__body[snake__body.length - 1].getAttribute("posX");
                var b = snake__body[snake__body.length - 1].getAttribute("posY");
                snake__body.push(document.querySelector('[posX = "' + a + '"][posY = "' + b + '"]'));
                create_mouse();
                score++;
                input.innerHTML = "Ваши очки: " + score;

              }

              if (snake__body[0].classList.contains("field-snake__body")) {
                document.querySelector(".snake__button").style.display = "block";
                input.classList.add("snake__game-over");
                clearInterval(interval);
                document.getElementById("snake__img").style.display = "block";
                input.innerHTML = "Game over<br>Ваши очки: " + score;

              }

              snake__body[0].classList.add("field-snake__head");
              for (var i = 0; i < snake__body.length; i++) {
                snake__body[i].classList.add("field-snake__body");
              }

              steps = true;

            }

            var interval = setInterval(move, 400);

            window.addEventListener("keydown", function (e) {
              if (steps == true) {
                if (e.keyCode == 37 && direction != "right") {
                  direction = "left";
                  steps = false;
                }
                if (e.keyCode == 38 && direction != "down") {
                  direction = "up";
                  steps = false;
                }
                if (e.keyCode == 39 && direction != "left") {
                  direction = "right";
                  steps = false;
                }
                if (e.keyCode == 40 && direction != "up") {
                  direction = "down";
                  steps = false;
                }
              }
            });

            $(".snake-driver__button--up").click(function () {
              if(direction != "down") {
              direction = "up";
              steps = false;
              return false;
              }
            });

            $(".snake-driver__button--right").click(function () {
              if(direction != "left") {
              direction = "right";
              steps = false;
              return false;
              }
            });

            $(".snake-driver__button--down").click(function () {
              if(direction != "up") {
              direction = "down";
              steps = false;
              return false;
              }
            });

            $(".snake-driver__button--left").click(function () {
              if(direction != "right") {
              direction = "left";
              steps = false;
              return false;
              }
            });
          };

          my_snke();

          $(".snake__button").click(function () {
            var exel = document.querySelector(".field-snake");
            exel.remove();
            document.querySelector("#snake__score").classList.remove("snake__game-over");
            document.querySelector("#snake__img").style.display = "none";
            document.querySelector(".snake__button").style.display = "none";
            my_snke();
            return false;
          });

        });

      </script>
    </section>
  </main>

  <include src="source/templates/footer.html"></include>

</body>

</html>
